<dataConfig>
  <dataSource type="JdbcDataSource" 
              driver="com.mysql.jdbc.Driver"
              url="jdbc:mysql://griffey-private.jaydenlucas.com/iwaat" 
              user="jliwaatwesley"
              password="eiof2!J@Issd$I6kfsd4"
			  encoding="UTF-8"/>
  <document>
    <entity name="app" pk="id"
		query="select apps.id,apps.name,apps.slug,apps.tagline,apps.description,apps.popularity_index,apps.status,apps.date_launched,apps.time_added,categories.name AS category, categories.slug AS category_slug FROM apps LEFT JOIN categories ON apps.category_id = categories.id"
		deltaImportQuery="select apps.id,apps.name,apps.slug,apps.tagline,apps.description,apps.popularity_index,apps.status,apps.date_launched,apps.time_added,categories.name AS category, categories.slug AS category_slug FROM apps LEFT JOIN categories ON apps.category_id = categories.id WHERE apps.id='${dataimporter.delta.id}'"
		deltaQuery="select id from apps WHERE time_updated > '${dataimporter.last_index_time}'">
		<field column="id" name="id" />
		<field column="name" name="name" />
		<field column="slug" name="slug" />
		<field column="tagline" name="tagline" />
		<field column="description" name="description" />
		<field column="popularity_index" name="popularity_index" />
		<field column="status" name="status" />
		<field column="category" name="category" />
		<field column="category_slug" name="category_slug" />
		<field column="date_launched" name="date_launched" />
		<field column="time_added" name="time_added" />
		<entity name="app_tag" pk="tag_id" query="select tag_id from app_tags where app_id = '${app.id}'">
			<entity name="tag" pk="id" query="select name from tags where id = '${app_tag.tag_id}'">
				<field column="name" name="tags" />
			</entity>
		</entity>
		<entity name="app_logo" pk="id" query="SELECT CONCAT('/images/apps/',SUBSTRING(CAST(app_id AS CHAR CHARACTER SET utf8),IF(app_id>9,-2,-1),2),'/',file_name) AS file_source FROM app_images WHERE app_id = '${app.id}' AND type = 'logo'">
			<field column="file_source" name="logo" />
		</entity>
		<entity name="app_screenshot" pk="id" query="SELECT CONCAT('/images/apps/',SUBSTRING(CAST(app_id AS CHAR CHARACTER SET utf8),IF(app_id>9,-2,-1),2),'/',file_name) AS file_source FROM app_images WHERE app_id = '${app.id}' AND type = 'screenshot'">
			<field column="file_source" name="screenshots" />
		</entity>
		<entity name="app_screenshot_large" pk="id" query="SELECT CONCAT('/images/apps/',SUBSTRING(CAST(app_id AS CHAR CHARACTER SET utf8),IF(app_id>9,-2,-1),2),'/',file_name) AS file_source FROM app_images WHERE app_id = '${app.id}' AND type = 'screenshot_large'">
			<field column="file_source" name="screenshot_large" />
		</entity>
		<entity name="app_screenshot_small" pk="id" query="SELECT CONCAT('/images/apps/',SUBSTRING(CAST(app_id AS CHAR CHARACTER SET utf8),IF(app_id>9,-2,-1),2),'/',file_name) AS file_source FROM app_images WHERE app_id = '${app.id}' AND type = 'screenshot_small'">
			<field column="file_source" name="screenshot_small" />
		</entity>
		<entity name="app_homepage_url" pk="id" query="SELECT url AS homepage_url FROM app_urls WHERE app_id = '${app.id}' AND type = 'homepage'">
			<field column="homepage_url" name="homepage_url" />
		</entity>
		<entity name="app_homepage_title" pk="id" query="SELECT data AS homepage_title FROM app_external_media WHERE app_id = '${app.id}' AND type = 'homepage_title'">
			<field column="homepage_title" name="homepage_title"/>
		</entity>
		<entity name="app_homepage_meta_keywords" pk="id" query="SELECT data AS homepage_meta_keywords FROM app_external_media WHERE app_id = '${app.id}' AND type = 'homepage_meta_keywords'">
			<field column="homepage_meta_keywords" name="homepage_meta_keywords"/>
		</entity>
		<entity name="app_homepage_meta_description" pk="id" query="SELECT data AS homepage_meta_description FROM app_external_media WHERE app_id = '${app.id}' AND type = 'homepage_meta_description'">
			<field column="homepage_meta_description" name="homepage_meta_description"/>
		</entity>
		<entity name="app_homepage_text" pk="id" query="SELECT data AS homepage_text FROM app_external_media WHERE app_id = '${app.id}' AND type = 'homepage_text'">
			<field column="homepage_text" name="homepage_text"/>
		</entity>
    </entity>
  </document>
</dataConfig>